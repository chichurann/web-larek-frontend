# Проектная работа "Веб-ларек"

# Архитектура приложения

Приложение разбито на слои согласно парадигме MVP: базовые классы, данные и представления (отображения или View). В приложении используется событийно-ориентированный подход. Презентер содержит обработчики событий, которые генерируются компонентами других слоев. Слой Presenter не выделяется в отдельные классы и будет реализован в index.ts.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

 
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, используемые в приложении
`IProductItem`
Интерфейс для описания карточки товара. Этот интерфейс описывает базовую структуру объекта товара и используется для хранения основной информации о товаре, такой как уникальный идентификатор, описание, изображение, название, категория и цена. Этот интерфейс необходим для типизации данных о товарах, поступающих из API.

Состав интерфейса:

id — уникальный идентификатор товара.
description — описание товара.
image — URL изображения товара.
title — название товара.
category — категория товара.
price — цена товара (или null, если цена отсутствует).
button — текст или значение кнопки, связанное с товаром.


`IOrderInfo`
Интерфейс для описания информации о заказе. Этот интерфейс используется для хранения данных, необходимых для оформления заказа, включая способ оплаты, контактные данные покупателя, адрес доставки и общую сумму заказа.


`IAppStore`
Интерфейс для описания состояния приложения. Он используется для хранения текущих данных приложения, таких как список товаров в каталоге, товары в корзине, информация о заказе и данные для предпросмотра.


`CategoryType`
Тип для описания категорий товаров. Используется для типизации категории товара в приложении. Возможные значения:
'другое','дополнительное','софт-скил','хард-скил','кнопка'


`ISettings`
Интерфейс для описания настроек приложения. Он используется для хранения настроек категории товаров в приложении.
 

`IModal`
Интерфейс для описания модального окна. Этот интерфейс используется для работы с модальными окнами в приложении.

`PaymentType`
Тип для описания способов оплаты заказа. Этот тип используется для типизации значения способа оплаты в заказах.


`PaymentDetailsForm`
Тип для описания формы с данными для оплаты и адреса доставки. Этот тип используется для типизации формы, в которой содержатся данные о способе оплаты и адресе.
 

`ContactDetailsForm`
Тип для описания формы с данными о контактной информации покупателя. Этот тип используется для типизации формы, содержащей адрес электронной почты и номер телефона.
  
`TOrderField`
Тип для представления всех полей заказа, которые включают контактные данные и данные о способе оплаты и адресе. Этот тип объединяет PaymentDetailsForm и ContactDetailsForm.
 

`FormErrors`
Тип для представления ошибок валидации формы на основе полей из IOrderInfo. Этот тип используется для хранения информации об ошибках валидации, которые могут возникать при заполнении формы заказа.
 

`IOrderResult`
Интерфейс для описания результата оформления заказа. Этот интерфейс используется для представления итоговых данных заказа, таких как его идентификатор и общая сумма.
 
`IForm`
Интерфейс для описания компонента формы. Этот интерфейс используется для типизации состояния формы и ошибок, связанных с ней.
 

`IPage`
Интерфейс для описания компонента страницы. Этот интерфейс используется для типизации состояния страницы и данных, таких как список элементов и состояние блокировки страницы.
 

`IModalData`
Интерфейс для описания данных модального окна. Этот интерфейс используется для типизации содержимого модального окна.
 
`ISuccess`
Интерфейс для представления успешного оформления заказа. Этот интерфейс используется для отображения итоговой суммы заказа после его успешного оформления.
 
`ISuccessHandler`
Интерфейс для описания обработчика нажатия кнопки после успешного оформления заказа. Этот интерфейс используется для добавления функционала кнопки на странице успешного оформления.



Класс `LarekAPI`
Этот класс расширяет базовый класс Api и реализует интерфейс ILarekApi. Он предоставляет методы для взаимодействия с API интернет-магазина, а также добавляет функциональность работы с CDN для загрузки изображений продуктов.
Конструктор класса принимает три параметра

Методы:

getProductItem(id: string): Promise<IProductItem>
Этот метод отправляет запрос на сервер для получения конкретного продукта по его id.
После получения данных, метод добавляет информацию о картинке продукта, в которой присутствует URL изображения 
Возвращает объект IProductItem — информацию о продукте.

getProductList(): Promise<IProductItem[]>
Этот метод отправляет запрос на сервер для получения списка всех продуктов.
После получения списка продуктов, метод добавляет CDN к каждому изображению продукта.
Возвращает массив объектов IProductItem[] — список продуктов.

orderProducts(order: IOrderInfo): Promise<IOrderResult>
Этот метод отправляет запрос на сервер с информацией о заказе продуктов.
Метод использует POST запрос для размещения заказа, отправляя данные заказа в теле запроса.
Возвращает объект IOrderResult — результат размещения заказа, включая ID заказа и его итоговую стоимость.


Класс `Component` 
Является абстрактным базовым компонентом, который предоставляет набор утилит и методов для работы с DOM-элементами в дочерних компонентах. Он используется как родительский класс для компонентов, которые требуют работы с DOM, и включает следующие методы:

Основные методы:
toggleClass(element: HTMLElement, className: string, force?: boolean)
Переключает класс для указанного элемента.
Если force равно true, класс добавляется, если false — удаляется. Если force не передан, класс просто переключается на противоположный.

 setText - устанавливает текстовое содержимое для элемента.
Это используется для обновления текста в элементах, таких как div, span, p и т. п.

setDisabled - изменяет состояние элемента на "disabled" (заблокирован).
 Это полезно для включения и отключения элементов формы, таких как кнопки или поля ввода.

setHidden - скрывает элемент, устанавливая его стиль display в 'none'.
Элемент не будет отображаться на странице, но останется в DOM.


setVisible - Отображает элемент, удаляя стиль display, если он был установлен в 'none'.
Элемент снова станет видимым на странице.

setImage - Устанавливает изображение для элемента img, задавая путь к изображению (src) и (опционально) текстовое описание (alt).Это полезно для динамического изменения изображений в интерфейсе.

render - Возвращает корневой элемент компонента (container), при этом может обновить его состояние, используя переданные данные (data).Это позволяет изменять внутренние данные компонента и автоматически обновлять DOM.



Класс `EventEmitter`
Реализует интерфейс IEvents и обеспечивает работу событий. Функции брокера события: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события».
Методы:
- `on` - устанавливает обработчик на указанное событие;
- `off` - удаляет обработчик с указанного события;
- `emit` - инициирует событие с указанным именем и данными;
- `onAll` - устанавливает обработчик, который будет вызываться для всех событий;
- `offAll` - cбрасывает все обработчики событий;
- `trigger` - cоздает функцию-триггер, которая генерирует событие при вызове


Класс `Modal` 
Класс `Modal` является дочерним классом от `Component` и представляет модальное окно,
которое может открываться и закрываться с анимациями и обработкой событий. Он используется для отображения
содержимого в виде всплывающего окна на странице.

Метод openModal() - Открывает модальное окно, добавляя класс modal_active к контейнеру, что делает модальное окно видимым.
Также вызывает событие modal:open, чтобы уведомить другие части приложения о том, что модальное окно открылось.

Метод closeModal()-Закрывает модальное окно, удаляя класс modal_active из контейнера.
Очищает содержимое модального окна, устанавливая content в null.
 
Метод render(data: IModalData): HTMLElement-Метод для рендеринга модального окна с переданными данными.
Вызывает родительский метод render для обновления контейнера.


Слой данных. Классы и описание модели данных

Класс `AppState` — это модель, которая управляет состоянием приложения, хранящим информацию о товарах в каталоге, корзине, заказе и ошибках формы. Этот класс также содержит методы для работы с этими данными, а также для обработки добавления и удаления товаров из корзины и оформления заказа.

Методы:
setCatalogItem - добавляет товары в каталог и эмиттит событие об изменении каталога.

setPreview - устанавливает товар для предварительного просмотра и эмиттит событие о его изменении.

getCardButton - возвращает строку, которая описывает состояние кнопки для товара: addToBasket (добавить в корзину) или removeFromBasket удалить из корзины

checkInBasket - проверяет, есть ли товар в корзине.

toggleBasketProduct - переключает состояние товара в корзине: если его нет, добавляет в корзину, если есть — удаляет.

addItemToBasket - обавляет товар в корзину и эмиттит событие об изменении корзины.

removeCard - удаляет товар из корзины и эмиттит событие об изменении корзины.

getCardIndex - возвращает индекс товара в корзине.

clearOrder - очищает данные заказа.

clearBasket -о чищает корзину и эмиттит событие об изменении корзины.

updateOrder - обновляет данные заказа на основе содержимого корзины, включая установку товаров и расчёт общей стоимости.

calculateTotalPrice - рассчитывает общую стоимость товаров в корзине.

setOrderPayment - устанавливает способ оплаты для заказа.

setOrderPhone - устанавливает номер телефона для заказа.

setOrderEmail - устанавливает email для заказа.

setOrderAddress - устанавливает адрес доставки для заказа.

setOrderField - устанавливает конкретное поле в заказе и вызывает валидацию формы заказа.

validateOrderForm - проверяет корректность данных заказа (email, телефон, адрес, способ оплаты) и сохраняет ошибки формы в formErrors. Возвращает true, если все данные валидны, и false — в противном случае.


Слой представлния 
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

Класс `Basket`

Поля класса:
_list — элемент DOM, который представляет список товаров в корзине.
_amount — элемент DOM, отображающий общую сумму товаров в корзине.
_button — кнопка для оформления заказа.

Он управляет отображением списка товаров в корзине, общей суммой, состоянием кнопки и взаимодействием с пользователем.

Методы:
set items - устанавливает элементы (товары) в корзину.Если товары есть, заменяет содержимое списка товаров (_list) на переданные элементы и активирует кнопку оформления заказа. Если корзина пуста, выводит сообщение о пустой корзине и деактивирует кнопку.
set selected - устанавливает выбранные товары в корзине. Деактивирует кнопку, если нет выбранных товаров, и активирует, если есть.
set sum  - устанавливает сумму для отображения в корзине (синапсы).
set amount - устанавливает количество синапсов для отображения в корзине (аналогично sum, но с другой логикой).


Класс `Form` 
Представляет собой компонент формы, который обрабатывает ввод данных, изменения состояний полей, а также валидацию и отображение ошибок. 

Поля:
_submit: Кнопка отправки формы.
_errors: Элемент, который отображает ошибки формы.


Методы:

onInputChange - этот метод обрабатывает изменения в полях формы, эмиттируя событие с именем поля и его значением.
set valid - устанавливает состояние кнопки отправки формы (включена или отключена). Если форма валидна (value равно true), кнопка отправки активируется.
set errors - устанавливает текст ошибок, который отображается в соответствующем элементе (_errors), обычно для вывода сообщений об ошибках валидации.
render - метод для рендеринга состояния формы, который обновляет элементы формы на основе переданных данных. Он также обновляет поля с состоянием valid и errors, а затем обновляет остальные поля формы.

 

Класс `Modal`
Представляет собой компонент модального окна, которое может быть открыто и закрыто, а также позволяет обновлять содержимое модального окна и обрабатывать действия пользователя.

Поля класса:
- `_closeButton` - кнопка для закрытия модального окна;
- `_content` - rонтейнер для содержимого модального окна.

Методы:
set content — этот метод устанавливает новое содержимое в модальное окно, заменяя существующее. Передача нового контента осуществляется через параметр value типа HTMLElement.

openModal — открывает модальное окно, добавляя класс modal_active к контейнеру окна. Также эмиттится событие modal:open.

closeModal — закрывает модальное окно, удаляя класс modal_active из контейнера и очищая содержимое окна. Эмиттится событие modal:close.

render — метод для рендеринга модального окна. Он принимает данные для модального окна (IModalData), отображает окно и вызывает метод openModal.


Класс `Order`
Представляет собой компонент формы для оформления заказа, обрабатывает выбор способа оплаты и управление состоянием кнопок, а также хранит информацию о платеже и адресе.

Поля:
buttonOnline - кнопка для выбора оплаты картой.
buttonCash - кнопка для выбора оплаты наличными.
_address - поле ввода для указания адреса доставки.

Методы:
set address — устанавливает значение поля ввода адреса в форме.
switchPaymentMethod — изменяет активное состояние кнопок выбора метода оплаты, добавляя класс button_alt-active к выбранной кнопке и удаляя его с других.
clearButtonState — сбрасывает активные состояния всех кнопок выбора метода оплаты, удаляя класс button_alt-active.


Класс `Contacts`
Представляет собой компонент формы ввода контактных данных (email и телефон).

Поля класса:
_email — поле для ввода email.
_phone — поле для ввода телефонного номера.

Методы:
set email — этот метод обновляет значение поля ввода email.
set phone — этот метод обновляет значение поля ввода телефона.


Класс `Success`
Представляет собой компонент, который отображает сообщение об успешном завершении операции, например, успешный заказ, с возможностью закрытия окна.

Поля класса:
close — кнопка для закрытия сообщения об успехе.
_success_description — элемент, отображающий описание успешной операции.

Методы:
set total — этот метод обновляет описание успеха, устанавливая текстовое значение с указанием списанных синапсов. Принимает числовое значение total и обновляет текст в элементе _success_description.


Класс `Card`
Представляет собой общий компонент карточки товара с базовой функциональностью, отображение изображения, названия, категории, цены и кнопки для добавления или удаления товара из корзины.

Поля класса:
_description — элемент для описания товара.
_image — изображение товара.
_title — заголовок товара.
_category — категория товара.
_price — цена товара.
_button — кнопка для взаимодействия с товаром (например, добавление в корзину).
Методы:
set id — устанавливает идентификатор товара.
get id — получает идентификатор товара.
set title — устанавливает название товара.
get title — получает название товара.
set image — устанавливает изображение товара, используя путь к изображению.
set disabled — устанавливает состояние кнопки (активна или неактивна).
set price — устанавливает цену товара или устанавливает цену как "Бесценно", если цена равна null.
set category — устанавливает категорию товара.
set button — изменяет текст кнопки (например, "Добавить в корзину" или "Убрать из корзины").


Класс `ProductItem` 
Наследуется от `Card` и добавляет дополнительные поля или методы для более детализированного отображения товара.
ProductItem добавляет поле для описания товара, которое можно установить с помощью метода set description.


Класс `BasketCard`
Этот класс наследует от `Card` и добавляет функциональность для отображения карточки товара в корзине.

Поля класса:
_index — индекс товара в корзине (например, порядковый номер).
_deleteButton — кнопка для удаления товара из корзины.
Методы:
set index — устанавливает порядковый номер товара в корзине.



Класс `Page`
Отвечает за управление элементами страницы, такими как счетчик товаров в корзине, каталог товаров и блокировка прокрутки. Он инкапсулирует логику взаимодействия с этими элементами, а также предоставляет методы для их обновления.

Свойства:

_counter: Элемент для отображения количества товаров в корзине.
_catalog: Элемент, в котором размещаются карточки товаров на странице.
_wrapper: Элемент-обёртка для страницы, используемый для блокировки прокрутки.
_basket: Элемент корзины, на который подписан обработчик событий для открытия корзины.э

Методы:

set catalog - метод для установки карточек товаров в каталог. Заменяет текущее содержимое каталога на переданные элементы.

set counter - метод для обновления счетчика товаров в корзине. Изменяет текст в элементе _counter, отображая количество товаров.

set locked - метод для блокировки или разблокировки прокрутки страницы. Если значение value равно true, добавляется класс page__wrapper_locked, иначе — он удаляется.



*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами моделями данных)*

catalog:updated — обновление списка товаров.
При обновлении каталога товаров из состояния приложения создается новый список карточек продуктов, который отображается на странице. Каждая карточка связывается с событием card:openDetails для открытия её детальной информации.

card:openDetails — открытие детальной карточки продукта.
При нажатии на карточку товара открывается модальное окно с её подробной информацией. Пользователь может добавить продукт в корзину, что инициирует событие basket:addProduct.

basket:addProduct — добавление товара в корзину.
Продукт добавляется в корзину, состояние корзины обновляется, и открывается модальное окно корзины.

basket:open — открытие корзины.
Показывает модальное окно с содержимым корзины.

basket:changed — обновление состояния корзины.
Обновляет количество товаров в корзине, итоговую сумму и отображает список товаров.

order:openForm — открытие формы заказа.
Показывает форму для ввода данных заказа, например, адреса доставки.

order:formUpdated — изменения в форме заказа.
Обновляет метод оплаты в состоянии приложения, проверяет валидность формы и обновляет её состояние.

order.address:change — обновление поля адреса в форме заказа.
Изменяет поле адреса доставки в состоянии приложения.

formErrors:changed — обновление ошибок формы.
Отображает ошибки в форме заказа и контактов, проверяя их валидность.

/contacts\.(phone|email):change/ — изменение полей контактов.
Обновляет поля телефона или email в состоянии заказа.

order:submit — подтверждение формы заказа.
Открывает форму для ввода контактных данных.

contacts:submit — подтверждение формы контактов.
Завершает заказ, отправляя данные на сервер. При успешной отправке очищается состояние корзины и заказа, а также показывается окно успешного оформления.

modal:open — открытие модального окна.
Блокирует прокрутку страницы, чтобы пользователь оставался на текущем экране.

modal:close — закрытие модального окна.
Разблокирует прокрутку страницы.